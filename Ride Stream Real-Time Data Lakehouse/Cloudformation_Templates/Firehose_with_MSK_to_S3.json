{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Create a Kinesis Firehose Delivery Stream that reads from MSK Serverless and writes to S3",
  "Resources": {
    "MyMSKBatchDeliveryStream": {
      "Type": "AWS::KinesisFirehose::DeliveryStream",
      "Properties": {
        "DeliveryStreamName": "MSK_Batch",
        "DeliveryStreamType": "MSKAsSource",
        "MSKSourceConfiguration": {
          "MSKClusterARN": "arn:aws:kafka:us-east-1:123456789101:cluster/MSKServerlessCluster/your-cluster-uuid-here",
          "TopicName": "your-topic-name",
          "AuthenticationConfiguration": {
            "RoleARN": "arn:aws:iam::123456789101:role/service-role/KinesisFirehoseServiceRole-AQI_Batch-us-east-1-1755365116218"
          }
        },
        "S3DestinationConfiguration": {
          "RoleARN": "arn:aws:iam::123456789101:role/service-role/KinesisFirehoseServiceRole-AQI_Batch-us-east-1-1755365116218",
          "BucketARN": "arn:aws:s3:::aws-glue-assets-123456789101-us-east-1",
          "Prefix": "input/",
          "BufferingHints": {
            "IntervalInSeconds": 300,
            "SizeInMBs": 5
          },
          "CompressionFormat": "UNCOMPRESSED",
          "ErrorOutputPrefix": "errors/"
        }
      }
    }
  },
  "Outputs": {
    "DeliveryStreamARN": {
      "Description": "ARN of the Kinesis Firehose Delivery Stream",
      "Value": {
        "Ref": "MyMSKBatchDeliveryStream"
      }
    },
    "DeliveryStreamName": {
      "Description": "Name of the Kinesis Firehose Delivery Stream",
      "Value": "MSK_Batch"
    }
  }
}
